{{ define "upload.html" }}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Upload Images</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <style>
        body {
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            margin: 0;
            padding: 0;
            background: #f2f2f2;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        .container {
            width: 90%;
            max-width: 480px;
        }

        .card {
            background: white;
            padding: 32px;
            border-radius: 16px;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            text-align: center;
        }

        h1 {
            margin-top: 0;
            font-size: 26px;
        }

        .drop-zone {
            margin-top: 24px;
            border: 2px solid #ccc;
            border-radius: 12px;
            padding: 50px 20px;
            cursor: pointer;
            font-size: 18px;
            transition: 0.2s ease;
            background: #fafafa;
            display: block;
        }

        .drop-zone:hover {
            border-color: #555;
            background: #f0f0f0;
        }

        input[type=file] {
            display: none;
        }

        .preview-list {
            margin-top: 20px;
            text-align: left;
            font-size: 16px;
            word-wrap: break-word;
        }

        .preview-item {
            margin-bottom: 6px;
        }

        .btn {
            margin-top: 26px;
            padding: 16px;
            background: #000;
            color: white;
            font-size: 18px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            width: 100%;
        }

        .btn:disabled {
            opacity: 0.6;
        }

        /* FIXED Saved Files section */
        .saved-wrapper {
            margin-top: 28px;
            text-align: left;
            font-size: 15px;
            word-break: break-word;
            line-height: 1.4;
            overflow-wrap: break-word;
        }

        .saved-wrapper ul {
            padding-left: 20px;
            margin-top: 6px;
        }

        .status {
            margin-top: 12px;
            font-size: 16px;
        }

        .error {
            color: #b00020;
        }
    </style>
</head>

<body>
<div class="container">
    <div class="card">

        <h1>Upload Images</h1>

        <form id="upload-form" method="post" enctype="multipart/form-data">

            <div class="drop-zone" id="drop-zone">
                <div id="drop-text">Tap here to choose images</div>
            </div>

            <input id="file-input" type="file" name="files" accept="image/*" multiple>

            <div id="preview" class="preview-list"></div>

            <button class="btn" type="submit" id="upload-btn">Upload</button>
        </form>

        <!-- FIXED Saved Files UI block -->
        <div class="saved-wrapper">
            {{ if .SavedFiles }}
            <strong>Saved files:</strong>
            <ul>
                {{ range .SavedFiles }}
                <li>{{ . }}</li>
                {{ end }}
            </ul>
            {{ end }}
        </div>

        <div class="status" id="status-text">
            {{ if .Error }}
            <div class="error">{{ .Error }}</div>
            {{ end }}
        </div>

    </div>
</div>

<script>
    const dropZone = document.getElementById("drop-zone");
    const fileInput = document.getElementById("file-input");
    const dropText = document.getElementById("drop-text");
    const preview = document.getElementById("preview");
    const uploadBtn = document.getElementById("upload-btn");
    const statusText = document.getElementById("status-text");
    const form = document.getElementById("upload-form");

    dropZone.addEventListener("click", () => fileInput.click());

    fileInput.addEventListener("change", () => {
        preview.innerHTML = "";

        if (fileInput.files.length === 0) {
            dropText.textContent = "Tap here to choose images";
            return;
        }

        dropText.textContent = fileInput.files.length + " files selected";

        for (const f of fileInput.files) {
            const item = document.createElement("div");
            item.className = "preview-item";
            item.textContent = f.name + " (" + Math.round(f.size / 1024) + " KB)";
            preview.appendChild(item);
        }
    });

    form.addEventListener("submit", (e) => {
        if (fileInput.files.length === 0) {
            e.preventDefault();
            statusText.textContent = "Select at least one image.";
            statusText.classList.add("error");
            return;
        }
        uploadBtn.disabled = true;
        uploadBtn.textContent = "Uploading...";
    });
</script>

</body>
</html>
{{ end }}
